---
title: "ソケット通信の仕組みをスライド図解と Go 実装で説明する"
emoji: "🔖"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["socket", "tcp", "socket", "go"]
published: true
---

# はじめに

先日、 `Linuxで動かしながら学ぶTCP/IPネットワーク入門` を読了ならびに実装しました。
こちらの本は下記に関して内容がわかりやすく記述されており、`入門` としてとても良い本でした。

- データリンク層におけるイーサネットを通るフレームの挙動
- TCP/IP の挙動
- アプリケーション層のプロトコル (HTTP / DHCP / NAT)
- socket 通信

https://www.amazon.co.jp/Linux%E3%81%A7%E5%8B%95%E3%81%8B%E3%81%97%E3%81%AA%E3%81%8C%E3%82%89%E5%AD%A6%E3%81%B6TCP-IP%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E5%85%A5%E9%96%80-%E3%82%82%E3%81%BF%E3%81%98%E3%81%82%E3%82%81-ebook/dp/B085BG8CH5

https://zenn.dev/ganariya/scraps/bb69305adef042

しかし、上記の本を進める中でソケット通信の内容が詳細には分からず、だいぶもどかしい気持ちになってしまいました。
分からなかった部分としては以下のようなものです。

- そもそも socket とはなにか
- Server で accept() したときに新しい socket を生成しているようだがこれはなにか
  - Server で最初に作成した `socket()` と同じものなのか
  - それともクライアント用の socket なのか
- Server の port 番号（例: 80）は固定でよいのか
  - 複数のクライアントから通信がくるため、 Server port 80 にやってきた通信がどの client のものかの判別方法
- pid port fd の違いについて

これら分からない部分が分からないままなのは嫌だったため、 Go における `Server: 1 Client: 多` ソケット通信プログラムを実装しました。
また、 Go のソケット通信の内部で何が行われているのかを大まかにコードリーディングしました。

<!-- textlint-disable -->
時間の経過とともに内容を忘れるであろう将来の自分、ならびにソケット通信の挙動がいまいち分からない方に向けて、今回学んだ内容をスライド図解とともにまとめます。
<!-- textlint-enable -->

https://docs.google.com/presentation/d/105qsTIXiZYoUKMhXeHqqM4dQf3pqDckdVoZw0w3vnyE/edit

## 対象読者

<!-- textlint-disable -->
- 記憶が曖昧になった将来の自分
- ソケット通信の挙動がいまいち分からない方
<!-- textlint-enable -->

## 扱う内容・扱わない内容

### 扱う内容

- 下記に関する図解説明
  - ファイルディスクリプタ
  - fork / pipe
  - socket
- Go におけるクライアント複数に対する Server の Echo 実装

上記に関して、その技術を使うことによる嬉しさならびに全体的な動きをスライド図解しながらまとめようと思います。

わかりやすさを優先して書く、ならびに筆者の知識が間違っている可能性から、内容の不備が存在しえます。
ぜひコメントをいただければと思います（修正させていただきます）。

### 扱わない内容

- 低レイヤ socket の実装
- 低レイヤ TCP / IP の実装

今度まとまった空き時間ができたら KLab のスライドを参考にしながら、自分でプロトコルを実装してみたいですね。
